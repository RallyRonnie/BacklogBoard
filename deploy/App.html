<!DOCTYPE html>
<html>
<head>
    <title>Backlog Board</title>

    <script type="text/javascript" src="/apps/2.0rc2/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("BLBoard",{extend:"Rally.app.App",componentCls:"app",launch:function(){var ppicker=Ext.create("Ext.Container",{items:[{xtype:"rallymultiobjectpicker",modelType:"project",emptyText:"Pick Projects",storeConfig:{fetch:["Name","ObjectID"]},listCfg:{displayField:["Name","ObjectID"]},listeners:{collapse:function(p){this.removeAll();var pcolumns="[",addNewConfig=null,cardBoardConfig=null;_.each(p.getValue(),function(pn){var pcolumn="{ value: '/project/"+pn.get("ObjectID")+"', columnHeaderConfig: { headerTpl: '{project}', headerData: { project: '"+pn.get("Name")+"' } } }";pcolumns=pcolumns+pcolumn+","}),pcolumns=pcolumns.substring(0,pcolumns.length-1)+"]",console.log(p.getValue()),addNewConfig={xtype:"rallyaddnew",recordTypes:["User Story","Defect"],ignoredRequiredFields:["Name","ScheduleState","Project"],listeners:{create:function(addNew,record){Ext.Msg.alert("Add New","Added record named "+record.get("Name"))}},showAddWithDetails:!0},cardBoardConfig={xtype:"rallycardboard",types:["User Story","Defect"],attribute:"Project",columns:eval(pcolumns),cardConfig:{fields:["Parent","Feature","Discussion","PlanEstimate"],editable:!0,showIconMenus:!0,showBlockedReason:!0},storeConfig:{filters:[{property:"ScheduleState",operator:"<",value:"In-Progress"},{property:"Iteration",operator:"=",value:""}],sorters:[{property:"Rank",direction:"ASC"}],context:this.getContext().getDataContext()}},this.add(addNewConfig),this.add(cardBoardConfig)},scope:this}}]});this.add(ppicker)}});

            Rally.launchApp('BLBoard', {
                name:"Backlog Board",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .app {
     /* Add app styles here */
}

    </style>
</head>
<body></body>
</html>
